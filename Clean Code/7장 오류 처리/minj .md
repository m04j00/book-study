# 7. 오류 처리

### 오류 코드보다 예외를 사용하라

- 오류 발생 시 예외를 사용하면 코드가 확실히 깔끔해지고 코드 품질도 나아진다.
- 오류 발생하면 디바이스를 종료하는 알고리즘과 오류를 처리하는 알고리즘을 분리해 각 개념을 독립적으로 살펴보고 이해할 수 있다.

### Try-Catch-Finally 문부터 작성하라

- 예외에서 프로그램 안에다 범위를 정의한다는 사실은 매우 흥미롭다.
- catch 블록에서 예외 유형을 좁혀 실제로 받는 예외를 잡아낸다.
- TDD를 할 때 먼저 강제로 예외를 일으키는 테스트 케이스를 작성한 후 테스트를 통과하게 코드를 작성하는 방법을 권장한다. 
그러면 자연스럽게 try 블록의 트랜잭션 범위부터 구현하게 되므로 범위 내에서 트랜잭션 본질을 유지하기 쉬워진다.

### 미확인 예외를 사용하라

- 초기 자바는 확인된 예외가 멋진 아이디어로 여겼다. 그렇지만 확인된 오류가 치르는 비용에 상응하는 이익을 제공하는지 따져봐야 한다.
- 확인된 예외는 OCP를 위반한다. 메소드에서 확인된 예외를 던졌을 때 catch 블록이 세 단계 위에 있다면 그 사이 메소드 모두가 선언부에 해당 예외를 정의해야 한다.
- 확인된 오류를 던진다면 함수는 선언부에 `throws` 절을 추가해야 한다. 그럴 경우 함수 모두가 catch 블록에서 새로운 예외를 처리하거나 선언분에 throws 절을 추가해야 한다. 
오류를 원거리에서 처리하기 위해 예외를 사용한다면 캡슐화를 깨버리는 현상이 발생한다.

### 예외에 의미를 제공하라

- 예외를 던질 때는 전후 상황을 충분히 덧붙인다. 그러면 오류가 발생한 원인과 위치를 찾기 쉬워진다.
- **오류 메시지에 정보를 담아 예외와 함께 던진다.**
    - 실패한 연산 이름과 실패 유형도 언급한다. 로깅을 사용한다면 catch 블록에서 오류를 기록하도록 충분한 정보를 넘겨준다.

### 호출자를 고려해 예외 클래스를 정의하라

- 애플리케이션에서 오류를 정의할 때 프로그래머에게 가장 중요한 관심사는 오류를 잡아내는 방법이 되어야 한다.
- 외부 라이브러리를 호출하는 try-catch-finally 문에서는, wrapper class를 사용하면 좋다. 호출하는 라이브러리 API를 감싸면서 예외 유형 하나를 반환하면 된다.

```java
LocalPort port = new LocalPort(12);

try {
	port.open();
} catch (PortDeviceFailure e) {
	reportError(e);
}

public class LoalPort {
	private ACMEPort innerPort;

	public LocalPort(int portNum) {
		innerPort = new ACMEPort(portNum);
	}
	public void open() {
		try {
			innerPort.open();
		} catch (DeviceResponseException e) {
			throw new PortDeviceFailure(e);
		} catch ...
	}
}
```

### 정상 흐름을 정의하라

- 특수 사례 패턴(Special Case Pattern)은 클래스를 만들거나 객체를 조작해 특수 사례를 처리하는 방식이다. 그러면 클라이언트 코드가 예외적인 상황을 처리할 필요가 없어진다.

### null을 반환하지 마라

- 사용하려는 API가 null을 반환한다면 감싸기 메소드를 구현해 예외를 던지거나 특수 사례 객체를 반환하는 방식을 고려한다.

```java
List<Employee> employees = getEmployees();
for(Employee e : employees) { }

public List<Employee> getEmployees() {
	if(직원이 없다면) {
		return Collections.emptyList();
	}
}
```

### null을 전달하지 마라

- 대다수 프로그래밍 언어는 호출자가 실수로 넘기는 null을 적절히 처리하는 방법이 없다. 그렇다면 처음부터 null을 넘기지 못하도록 금지하는 정책이 합리적이다.

### 결론

- 오류 처리를 프로그램 논리와 분리해 독자적인 사안을 고려하면 깨끗한 코드를 작성할 수 있다.
- 오류 처리를 프로그램 논리와 분리하면 독립적인 추론이 가능해지며 코드 유지보수성도 크게 높아진다.

## 느낀점

깨끗한 코드를 만들기 위한 오류 처리에 대해 알게되는 시간이었다. php 개발을 하면서 프론트, 백 모두 null 등 유효성 검사를 두번씩 처리해 잘못된 값이 들어오지 못하도록 확인하고 있었다. 그런데 어떤 값이든 empty()를 사용해 빈값인지 확인하는데 계속해서 빈값을 확인하는 게 맞는지 의아할 때도 있었다. 결론은 null을 반환하지도 전달하지도 말았어야 했던 것이다. 앞으로는 깨끗한 코드를 짤 수 있도록 계속해서 노력해야겠다. 

그리고 예외 클래스 정의, 특수 사례 패턴에 대해 알게 되어 더 좋은 코드를 짤 수 있는 기분이 들었다. 시니어 개발자에게 배움을 얻어가는 건 언제나 유익한 거 같다. 어떻게 보면, 고인물들에 의해 코드가 변화하지 못할 수도 있지만 유익한 코드 짜는 방법을 배우게 되면 얼른 배운 것을 써먹고 싶어진다. 시니어 개발자에게 지혜를 배웠다면, 나는 새로 개발된 기술들을 공유하여 순환관계를 지속적으로 맺고싶다는 생각이 들었다.
